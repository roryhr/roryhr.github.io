<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Rory's Corner - python</title>
        <link rel="stylesheet" href="http://roryhr.com/theme/css/main.css" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151184132-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-151184132-1');
        </script>
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://roryhr.com/">Rory's Corner </a></h1>
                <nav><ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/articles">Articles</a></li>
                    <li><a href="/pages/about">About</a></li>
                    <li><a href="/pages/projects">Projects</a></li>
                    <li><a href="/pages/contact">Contact</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://roryhr.com/approach-to-python.html">Approach to Python</a></h1>
<footer class="post-info">
        <abbr class="published" title="2019-08-15T00:00:00-07:00">
                Published: Thu 15 August 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://roryhr.com/author/rory-hartong-redden.html">Rory Hartong-Redden</a>
        </address>
<p>In <a href="http://roryhr.com/category/python.html">Python</a>.</p>
<p>tags: <a href="http://roryhr.com/tag/python.html">python</a> </p>
</footer><!-- /.post-info --><p>Note:</p>
<p>I like to phrase things as punchy commands but it's all just my preference.
My personal style is constantly evolving.</p>
<p>My motto is a twist on the Zen of Python</p>
<div class="highlight"><pre><span></span>If the implementation is hard to understand, it&#39;s bad.
If the implementation is easy to understand, it may be good.
</pre></div>


<h1>Style Guide</h1>
<p>List comprehensions are your bread and butter. Structure them like a SQL query.</p>
<div class="highlight"><pre><span></span><span class="n">cleaned_emails</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">email</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">email</span>
    <span class="ow">in</span> <span class="n">emails</span>
    <span class="k">if</span> <span class="s1">&#39;@test.com&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">email</span>
<span class="p">]</span>
</pre></div>


<p>Give the <a href="https://numpydoc.readthedocs.io/en/latest/format.html">The Numpy docstring style</a> a try.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clean_emails</span><span class="p">(</span><span class="n">emails</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Clean up emails from source database</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    emails : list</span>
<span class="sd">        Raw email addresses</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cleaned_emails : list</span>
<span class="sd">        Cleaned email addresses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cleaned_emails</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">email</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">email</span>
        <span class="ow">in</span> <span class="n">emails</span>
        <span class="k">if</span> <span class="s1">&#39;@test.com&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">email</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">cleaned_emails</span>
</pre></div>


<p>Naming things is hard. Do it well! 
Conserve your colleagues' brainpower: if a function has a good name and docstring then they don't have to understand <em>how it works</em> to understand <em>what it does</em>. </p>
<p>Use SQL where possible, it's more readable than the PySpark equivalent.</p>
<div class="highlight"><pre><span></span><span class="n">user_df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT id,</span>
<span class="s2">       created_at,</span>
<span class="s2">       dt AS partition</span>
<span class="s2">  FROM users</span>
<span class="s2"> WHERE updated_at IS NOT NULL</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>


<p>Distinguish between Spark DataFrames and Pandas DataFrames when mixing the two. </p>
<div class="highlight"><pre><span></span><span class="n">user_pdf</span> <span class="o">=</span> <span class="n">user_df</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
</pre></div>


<p>Other Spark preferences:
Distinguish between Spark DataFrames and Pandas DataFrames when mixing the two.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark</span>
<span class="kn">import</span> <span class="nn">pyspark.sql.types</span> <span class="kn">as</span> <span class="nn">T</span> 
<span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">as</span> <span class="nn">F</span>
</pre></div>


<p>As the <a href="http://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.SparkSession">documentation</a> says, the preferred entry point for Spark is through <code>spark</code>.</p>
<div class="highlight"><pre><span></span><span class="c1"># Yes</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">()</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">sequenceFile</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * FROM users&quot;&quot;&quot;</span><span class="p">)</span>
<span class="c1"># No</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">()</span>
<span class="n">sparkContext</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * FROM users&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">hiveContext</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT * FROM users&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>


<h1>Writing Scripts</h1>
<p>Start with functions.
If you find yourself passing several parameters between functions then make a class.</p>
<p>Let's say you have a PySpark script called <code>anonymize_emails.py</code> which needs a date and a database. </p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pyspark</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>

    <span class="n">spark</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span>\
        <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s1">&#39;Anonymize Emails for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">date</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>

    <span class="n">anonymize_emails</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
</pre></div>


<p>Explicitly ignore extra parameters if you want.</p>
<div class="highlight"><pre><span></span>_, database, date, *_ = sys.argv
</pre></div>


<p>I'm not a huge fan of the trailing backslash for new lines but it's common in Spark and growing on me. 
For Pandas I still prefer to use parentheses. 
In any case put each operation on new line. </p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;time_on_page&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;average_time_on_page.csv&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<p>Jupyter Notebooks are your friend. 
Especially for data science you'll want to iterate: see what's in the data, check the processing did what you think it did, and see how long each chunk of code takes to run. 
Super helpful for development! 
What's a natural chunk of code?
A function, of course. </p>
<p>Once everything is working clean up the notebook and add some nice comments and descriptive text.
Now you're ready to transfer this code to a proper script and deploy it.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://roryhr.com/python-environments.html" rel="bookmark"
                           title="Permalink to Python Environments">Python Environments</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-08-13T00:00:00-07:00">
                Published: Mon 13 August 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://roryhr.com/author/rory-hartong-redden.html">Rory Hartong-Redden</a>
        </address>
<p>In <a href="http://roryhr.com/category/python.html">Python</a>.</p>
<p>tags: <a href="http://roryhr.com/tag/python.html">python</a> <a href="http://roryhr.com/tag/miniessays.html">miniessays</a> </p>
</footer><!-- /.post-info -->                <ol>
<li>Why should I care about environments?</li>
<li>How do I manage environments? </li>
<li>Demo</li>
</ol>
<h1>Why should I care about environments?</h1>
<p>Suppose you work on two projects, one is old and written in Python 2, the other is new and uses Python 3. 
The only way to work on this pair of projects …</p>
                <a class="readmore" href="http://roryhr.com/python-environments.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://roryhr.com/code-for-tomorrow.html" rel="bookmark"
                           title="Permalink to Code for Tomorrow">Code for Tomorrow</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-04-02T00:00:00-07:00">
                Published: Mon 02 April 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://roryhr.com/author/rory-hartong-redden.html">Rory Hartong-Redden</a>
        </address>
<p>In <a href="http://roryhr.com/category/blog.html">blog</a>.</p>
<p>tags: <a href="http://roryhr.com/tag/python.html">python</a> <a href="http://roryhr.com/tag/miniessays.html">miniessays</a> </p>
</footer><!-- /.post-info -->                <p>This is the first of a series of short articles.</p>
<h1>Code for Tomorrow</h1>
<p>How do you know if your code is good? 
This is subjective, to be sure, but is clarified by answering a given question which sets the standard by which the code is judged.
The most question being …</p>
                <a class="readmore" href="http://roryhr.com/code-for-tomorrow.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://roryhr.com/pycon-talks.html" rel="bookmark"
                           title="Permalink to PyCon Talks">PyCon Talks</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-03-20T00:00:00-07:00">
                Published: Sun 20 March 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://roryhr.com/author/rory-hartong-redden.html">Rory Hartong-Redden</a>
        </address>
<p>In <a href="http://roryhr.com/category/python.html">Python</a>.</p>
<p>tags: <a href="http://roryhr.com/tag/open-source.html">open source</a> <a href="http://roryhr.com/tag/pycon.html">pycon</a> <a href="http://roryhr.com/tag/python.html">python</a> <a href="http://roryhr.com/tag/links.html">links</a> </p>
</footer><!-- /.post-info -->                <p>There are tons of great PyCon talks on YouTube and I haven't even scratched the surface
of what's out there but here are a few that struck me.</p>
<h2>Development of Open-Source Communities</h2>
<p><a href="https://youtu.be/O8CbzKREAj4">Keynote - EuroSciPy 2015 - Pieter Hintjens</a></p>
<p>Key points:</p>
<ol>
<li>Wikipedia is the model</li>
<li>It has no competition!</li>
<li>The model clearly …</li></ol>
                <a class="readmore" href="http://roryhr.com/pycon-talks.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://baypiggies.net/">BayPIGies</a></li>
                            <li><a href="http://pyninsula.org/">Pyninsula</a></li>
                            <li><a href="http://sfpythonmeetup.com/">SF Python</a></li>
                            <li><a href="http://blog.kaggle.com/">No Free Hunch (Kaggle)</a></li>
                            <li><a href="http://efavdb.com/">EFAVDB</a></li>
                            <li><a href="http://multithreaded.stitchfix.com/">MultiThreaded</a></li>
                            <li><a href="http://sisl.stanford.edu/">SISL</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://github.com/roryhr">Github</a></li>
                            <li><a href="https://www.linkedin.com/in/rory-hartong-redden-18334356">LinkedIn</a></li>
                            <li><a href="https://twitter.com/rory_h_r">Twitter</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>